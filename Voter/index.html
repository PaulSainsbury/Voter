<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="Scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="Scripts/knockout-2.1.0.js" type="text/javascript"></script>
    <script src="Scripts/jquery.signalR-0.5.0.min.js" type="text/javascript"></script>
    <script src="Scripts/html5slider.js" type="text/javascript"></script>
    <script src="Scripts/jquery.loadmask.min.js" type="text/javascript"></script>
    <link href="Styles/jquery.loadmask.css" rel="stylesheet" type="text/css" />

    <script src="signalr/hubs" type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            function TalkEval() {
                var myVote = {
                    speed: 0,
                    preparation: 0,
                    techValue: 0,
                    demos: 0,
                    comments: ''
                };

                this.init = function () {
                    // Private variables
                    var hub = $.connection.vote;
                    // Private functions
                    function voteValueToString(value, lessValue, zeroValue, moreValue) {
                        if (value < 0) {
                            return lessValue;
                        } else if (value == 0) {
                            return zeroValue;
                        } else {
                            return moreValue;
                        }
                    };

                    function setRange(name, value, maxValue) {
                        maxValue = maxValue || 1;
                        value = value || 0;
                        $("#" + name).attr("min", -maxValue).attr("max", maxValue).val(value);
                    };

                    function getName(prefix, value, low, mid, high) {
                        return prefix + (value > 0 ? high : (value < 0 ? low : mid));
                    };

                    // Setup code and events
                    hub.updateVotes = function (result) {
                        $("body").unmask();
                        console.log('unmasking');
                        if (result.numberOfVotes !== null) {
                            $("#numVotes").html(result.numberOfVotes);
                            setRange("rangeSpeed", result.speed, result.numberOfVotes);
                            setRange("rangePreparation", result.preparation, result.numberOfVotes);
                            setRange("rangeTechValue", result.techValue, result.numberOfVotes);
                            setRange("rangeDemos", result.demos, result.numberOfVotes);

                            $("#lblComments").html(result.comments);
                        }
                    };

                    hub.setValue = function (vote) {
                        $("body").unmask();
                        myVote = vote;

                        var speed = $("#" + getName("rbSpeed", vote.speed, "Slow", "Perfect", "Fast")).attr("checked", "checked"),
                            prepared = $("#" + getName("rbPrepared", vote.prepared, "None", "Ok", "Well")).attr("checked", "checked"),
                            tech = $("#" + getName("rbTech", vote.techValue, "None", "Some", "All")).attr("checked", "checked"),
                            demo = $("#" + getName("rbDemo", vote.demos, "Few", "Enough", "ToMany")).attr("checked", "checked"),
                            comment = $("#txtComment").val(vote.comments);
                    }

                    $.connection.hub.start();

                    $("#btnSubmit").click(function () {
                        $("body").mask("Sending...");
                        var speedVal = $("input[name=rbSpeed]:checked").val(),
                            preparedVal = $("input[name=rbPreparation]:checked").val(),
                            techVal = $("input[name=rbTechValue]:checked").val(),
                            demoVal = $("input[name=rbDemo]:checked").val(),
                            commentVal = $("#txtComment").val();

                        myVote.speed = speedVal;
                        myVote.preparation = preparedVal;
                        myVote.techValue = techVal;
                        myVote.demos = demoVal;
                        myVote.comments = commentVal;

                        hub.setVote(myVote);
                    });
                    $("#btnReset").click(function () {
                        $("body").mask("Resetting...");
                        hub.resetVotes();
                    });
                }
            };
            var talkEval = new TalkEval();
            talkEval.init();
        });
    </script>

</head>
<body>
    <table>
        <tr>
            <td>
                Speed of talk?
            </td>
            <td>
                <label for="rbSpeedSlow">
                    <input type="radio" id="rbSpeedSlow" name="rbSpeed" value="-1" />
                    To Slow
                </label>
            </td>
            <td>
                <label for="rbSpeedPerfect">
                    <input type="radio" id="rbSpeedPerfect" name="rbSpeed" value="0" checked="checked" />
                    Perfect
                </label>
            </td>
            <td>
                <label for="rbSpeedFast">
                    <input type="radio" id="rbSpeedFast" name="rbSpeed" value="+1" />
                    To Fast
                </label>
            </td>
        </tr>
        <tr>
            <td>
                How well was the talk prepared?
            </td>
            <td>
                <label for="rbPreparedNone">
                    <input type="radio" id="rbPreparedNone" name="rbPreparation" value="-1" />
                    Not at all
                </label>
            </td>
            <td>
                <label for="rbPreparedOk">
                    <input type="radio" id="rbPreparedOk" name="rbPreparation" value="0" checked="checked" />
                    Ok
                </label>
            </td>
            <td>
                <label for="rbPreparedWell">
                    <input type="radio" id="rbPreparedWell" name="rbPreparation" value="+1" />
                    Well prepared
                </label>
            </td>
        </tr>
        <tr>
            <td>
                Technical Value?
            </td>
            <td>
                <label for="rbTechNone">
                    <input type="radio" id="rbTechNone" name="rbTechValue" value="-1" />
                    Nothing of value
                </label>
            </td>
            <td>
                <label for="rbTechSome">
                    <input type="radio" id="rbTechSome" name="rbTechValue" value="0" checked="checked" />
                    Some value
                </label>
            </td>
            <td>
                <label for="rbTechAll">
                    <input type="radio" id="rbTechAll" name="rbTechValue" value="+1" />
                    Super valuable
                </label>
            </td>
        </tr>
        <tr>
            <td>
                Amount of Demos?
            </td>
            <td>
                <label for="rbDemoFew">
                    <input type="radio" id="rbDemoFew" name="rbDemo" value="-1" />
                    To Few
                </label>
            </td>
            <td>
                <label for="rbDemoEnough">
                    <input type="radio" id="rbDemoEnough" name="rbDemo" value="0" checked="checked" />
                    Enough
                </label>
            </td>
            <td>
                <label for="rbDemoToMany">
                    <input type="radio" id="rbDemoToMany" name="rbDemo" value="+1" />
                    To many
                </label>
            </td>
        </tr>
        <tr>
            <td colspan="4">Comment</td>
        </tr>
        <tr>
            <td colspan="4">
                <textarea cols="75" rows="5" id="txtComment"></textarea>
            </td>
        </tr>
    </table>
    <input type="button" value="Submit" id="btnSubmit" />
    <input type="button" value="Reset" id="btnReset" /> <br />
    Out of <div id="numVotes" style=" display: inline">0</div> votes<br />
    <table>
        <tr>
            <td> Speed : </td>
            <td> Too Slow </td>
            <td> <input id="rangeSpeed" type="range" min="-1" max="1" value="0" /></td>
            <td> Too Fast </td>
        </tr>
        <tr>
            <td> Preparation :</td>
            <td> Not at all</td>
            <td> <input id="rangePreparation" type="range" min="-1" max="1" value="0" /></td>
            <td> Well Prepared</td>
        </tr>
        <tr>
            <td> Tech Value : </td>
            <td> Nothing of Value </td>
            <td> <input id="rangeTechValue" type="range" min="-1" max="1" value="0" /></td>
            <td> Super valuable</td>
        </tr>
        <tr>
            <td> Demos :</td>
            <td> To Few </td>
            <td> <input id="rangeDemos" type="range" min="-1" max="1" value="0" /></td>
            <td> To many </td>
        </tr>
        <tr>
            <td colspan="4">Comments:</td>
        </tr>
        <tr>
            <td colspan="4"><span id="lblComments"></span></td>
        </tr>
    </table>
</body>
</html>
